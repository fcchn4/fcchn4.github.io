<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Fcch Blog | Apuntes, guías y recordatorios</title>
    <link>https://blog.fcch.xyz/post/infrastructure/</link>
    <description>Recent content on Fcch Blog | Apuntes, guías y recordatorios</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <copyright>Fcch Blog | 2019 - 2021</copyright>
    <lastBuildDate>Sat, 24 Jul 2021 00:00:00 +0000</lastBuildDate><atom:link href="https://blog.fcch.xyz/post/infrastructure/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>K3s Apuntes - Parte 2</title>
      <link>https://blog.fcch.xyz/post/infrastructure/k3s-notes-second/</link>
      <pubDate>Sat, 24 Jul 2021 00:00:00 +0000</pubDate>
      
      <guid>https://blog.fcch.xyz/post/infrastructure/k3s-notes-second/</guid>
      <description>
        
          &lt;p&gt;Continuamos con las pruebas en nuestro pequeño cluster con &lt;a href=&#34;https://k3s.io/&#34;&gt;&lt;strong&gt;K3s&lt;/strong&gt;&lt;/a&gt; armado en las &lt;a href=&#34;https://www.raspberrypi.org/&#34;&gt;&lt;strong&gt;Raspberry Pi (RPI v3, RPI v4)&lt;/strong&gt;&lt;/a&gt; que tengo en mi laboratorio, para las pruebas utlizamos la documentación oficial de &lt;a href=&#34;https://rancher.com/docs/k3s/latest/en/&#34;&gt;&lt;strong&gt;K3s - Rancher&lt;/strong&gt;&lt;/a&gt; y también la documentación oficial de &lt;a href=&#34;https://kubernetes.io/docs/tutorials/kubernetes-basics/&#34;&gt;&lt;strong&gt;Kubernetes&lt;/strong&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://blog.fcch.xyz/images/k3s-kubernetes/k3s-rpi-v3-v4.jpg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;En la imagen tenemos como detalle:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;Tres Raspberry Pi 4, Modelo B&lt;/strong&gt; (1 Server Node y 2 Worker Nodes).&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Dos Raspberry Pi 3, Modelo B&lt;/strong&gt; (2 Worker Nodes, ).&lt;/li&gt;
&lt;li&gt;Un &lt;strong&gt;Switch Desktop Gigabit Tp-Link TL-SG1008D&lt;/strong&gt; de 8 puertos.&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;conceptos-básicos&#34;&gt;Conceptos Básicos&lt;/h2&gt;
&lt;p&gt;Con los componentes de Kubernetes:&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://blog.fcch.xyz/images/k3s-kubernetes/components-of-kubernetes.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;Podemos describir algunos componentes importantes:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;kube-apiserver&lt;/strong&gt;: El servidor de API es un componente del plano de control de Kubernetes que expone la API de Kubernetes. El servidor de API es la interfaz del plano de control de Kubernetes.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;etcd&lt;/strong&gt;: Base de datos de tipo &lt;em&gt;clave-valor&lt;/em&gt; consistente y de alta disponibilidad utilizado como almacén de respaldo de Kubernetes para todos los datos del clúster.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;kube-scheduler&lt;/strong&gt;: Componente del plano de control que busca pods recién creados sin un nodo asignado y selecciona un nodo para que se ejecuten.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;kube-controller-manager&lt;/strong&gt;: Componente del plano de control que ejecuta los procesos del controlador.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;em&gt;Controlador de nodo&lt;/em&gt;: Responsable de notar y responder cuando los nodos se caen.&lt;/li&gt;
&lt;li&gt;&lt;em&gt;Controlador de trabajo&lt;/em&gt;: Busca objetos de trabajo que representan tareas únicas y luego crea pods para ejecutar esas tareas hasta su finalización.&lt;/li&gt;
&lt;li&gt;&lt;em&gt;Controlador de puntos finales&lt;/em&gt;: Completa el objeto de puntos finales (es decir, se une a servicios y pods).&lt;/li&gt;
&lt;li&gt;&lt;em&gt;Controladores de cuentas de servicio y tokens&lt;/em&gt;: Crea cuentas predeterminadas y tokens de acceso a la API para nuevos espacios de nombres.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;cloud-controller-manager&lt;/strong&gt;: Un componente del plano de control de Kubernetes que incorpora una lógica de control específica de la nube (se ejecuta en un solo proceso con &lt;em&gt;kube-controller-manager&lt;/em&gt;).&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;em&gt;Controlador de nodo&lt;/em&gt;: Para verificar el proveedor de la nube para determinar si un nodo se ha eliminado en la nube después de que deja de responder.&lt;/li&gt;
&lt;li&gt;&lt;em&gt;Controlador de ruta&lt;/em&gt;: Para configurar rutas en la infraestructura de nube subyacente.&lt;/li&gt;
&lt;li&gt;Controlador de servicio*: Para crear, actualizar y eliminar equilibradores de carga de proveedores de nube.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;kubelet&lt;/strong&gt;: Un agente que se ejecuta en cada nodo del clúster, se asegura de que los contenedores se ejecuten en un Pod.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;kube-proxy&lt;/strong&gt;: Es un proxy de red que se ejecuta en cada nodo de su clúster, implementando parte del concepto de servicio de Kubernetes.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;container runtime&lt;/strong&gt;: El tiempo de ejecución del contenedor es el software responsable de ejecutar los contenedores.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;kube-scheduler&lt;/strong&gt;: Componente del plano de control que busca pods recién creados sin un nodo asignado y selecciona un nodo para que se ejecuten.&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;instalación-kubectl&#34;&gt;Instalación Kubectl&lt;/h2&gt;
&lt;p&gt;Para poder trabajar con nuestro cluter &lt;strong&gt;RPI&lt;/strong&gt; de &lt;a href=&#34;https://k3s.io/&#34;&gt;K3s&lt;/a&gt;, podemos trabajar desde el &lt;strong&gt;Server Node&lt;/strong&gt; o instalar &lt;a href=&#34;https://kubernetes.io/docs/tasks/tools/install-kubectl-linux/&#34;&gt;kubectl&lt;/a&gt; en nuestra computadora personal, para este caso instalaremos el paquete para una distribución &lt;a href=&#34;https://www.gnu.org/home.es.html&#34;&gt;GNU/Linux&lt;/a&gt;, &lt;a href=&#34;https://debian.org&#34;&gt;Debian Buster 10&lt;/a&gt; agregando el repositorio de la siguiente forma:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;ln&#34;&gt; 1&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;# Actualizar e instalar los paquetes necesarios&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 2&lt;/span&gt;$ sudo apt-get update
&lt;span class=&#34;ln&#34;&gt; 3&lt;/span&gt;$ sudo apt-get install -y apt-transport-https ca-certificates curl
&lt;span class=&#34;ln&#34;&gt; 4&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;# Descargamos la clave de firma pública&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 5&lt;/span&gt;$ sudo curl -fsSLo /usr/share/keyrings/kubernetes-archive-keyring.gpg https://packages.cloud.google.com/apt/doc/apt-key.gpg
&lt;span class=&#34;ln&#34;&gt; 6&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;# Agregar el repositorio oficial&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 7&lt;/span&gt;$ &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;deb [signed-by=/usr/share/keyrings/kubernetes-archive-keyring.gpg] https://apt.kubernetes.io/ kubernetes-xenial main&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; sudo tee /etc/apt/sources.list.d/kubernetes.list
&lt;span class=&#34;ln&#34;&gt; 8&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;# Actualizar nuevamente e instalamos el paquete&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt; 9&lt;/span&gt;$ sudo apt install update
&lt;span class=&#34;ln&#34;&gt;10&lt;/span&gt;$ sudo apt install -y kubectl
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;configuración-de-kubectl-con-el-cluster-k3s&#34;&gt;Configuración de Kubectl con el Cluster K3s&lt;/h2&gt;
&lt;p&gt;Para trabajar desde nuestra computadora personal, tenemos que crear un archivo de configuración dentro de la carpeta &lt;strong&gt;.kube&lt;/strong&gt; el archivo de configuración debe tener el nombre &lt;strong&gt;config&lt;/strong&gt;, la carpeta y el archivo deben ser creados con los permisos adecuados:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;ln&#34;&gt;1&lt;/span&gt;$ mkdir ~/.kube
&lt;span class=&#34;ln&#34;&gt;2&lt;/span&gt;$ touch ~/.kube/config
&lt;span class=&#34;ln&#34;&gt;3&lt;/span&gt;$ chmod &lt;span class=&#34;m&#34;&gt;775&lt;/span&gt; ~/.kube
&lt;span class=&#34;ln&#34;&gt;4&lt;/span&gt;$ chmod &lt;span class=&#34;m&#34;&gt;420&lt;/span&gt; ~/.kube/config
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;El contenido del archivo &lt;strong&gt;config&lt;/strong&gt; debe ser similar a este:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;ln&#34;&gt; 1&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;apiVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;v1&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;ln&#34;&gt; 2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;clusters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;ln&#34;&gt; 3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;- &lt;span class=&#34;k&#34;&gt;cluster&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;ln&#34;&gt; 4&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;certificate-authority-data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;CONTENIDO_DEL_CERTIFICADO&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;ln&#34;&gt; 5&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;server&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;https&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;//IP_O_DOMINIO&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;6443&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;ln&#34;&gt; 6&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;default&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;ln&#34;&gt; 7&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;contexts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;ln&#34;&gt; 8&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;- &lt;span class=&#34;k&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;ln&#34;&gt; 9&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;cluster&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;default&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;ln&#34;&gt;10&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;user&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;default&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;ln&#34;&gt;11&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;default&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;ln&#34;&gt;12&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;current-context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;default&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;ln&#34;&gt;13&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;kind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;Config&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;ln&#34;&gt;14&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;preferences&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;{}&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;ln&#34;&gt;15&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;users&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;ln&#34;&gt;16&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;- &lt;span class=&#34;k&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;default&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;ln&#34;&gt;17&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;user&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;ln&#34;&gt;18&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;client-certificate-data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;CONTENIDO_DEL_CERTIFICADO&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;ln&#34;&gt;19&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;client-key-data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;CONTENIDO_DE_LA_CLAVE_DEL_CERTIFICADO&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Estos datos se pueden obtener desde el &lt;strong&gt;Server Node&lt;/strong&gt;, exactamente el dato se encuentra en &lt;strong&gt;/etc/rancher/k3s/k3s.yaml&lt;/strong&gt;.&lt;/p&gt;
&lt;h2 id=&#34;pruebas-después-de-la-instalación&#34;&gt;Pruebas Después de la Instalación&lt;/h2&gt;
&lt;p&gt;Desde nuestra computadora local podemos ejecutar los siguientes comandos:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;ln&#34;&gt;1&lt;/span&gt;$ kubectl version
&lt;span class=&#34;ln&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;# Si existe algún problema con el anterior comando podemos ejecutar:&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;3&lt;/span&gt;$ kubectl version --client&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;true&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Si todo está correcto tendremos una salida similar a esta:&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://blog.fcch.xyz/images/k3s-kubernetes/kubectl-version-tests-v2.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;Comandos útiles para iniciar:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;ln&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;# Obtener ayuda&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;2&lt;/span&gt;$ kubectl --help
&lt;span class=&#34;ln&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;# Listar todos los contextos en su archivo kubeconfig&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;4&lt;/span&gt;$ kubectl config get-contexts
&lt;span class=&#34;ln&#34;&gt;5&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;# Listar todos los nodos disponibles&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;6&lt;/span&gt;$ kubectl get nodes
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;referencias&#34;&gt;Referencias&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://rancher.com/docs/k3s/latest/en/quick-start/&#34;&gt;&lt;strong&gt;Inicio Rápido&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://rancher.com/docs/k3s/latest/en/installation/kube-dashboard/&#34;&gt;&lt;strong&gt;Kube Dashboard&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://rancher.com/docs/&#34;&gt;&lt;strong&gt;Docs K3S&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://kubernetes.io/docs/concepts/_print/&#34;&gt;&lt;strong&gt;Conceptos Kubernetes&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://kubernetes.io/docs/tutorials/kubernetes-basics/&#34;&gt;&lt;strong&gt;Docs Kubernetes&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://etcd.io/&#34;&gt;&lt;strong&gt;etcd&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://rancher.com/docs/rancher/v2.x/en/cluster-admin/cluster-access/kubectl/&#34;&gt;&lt;strong&gt;Cluster Admin Access&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://rancher.com/docs/k3s/latest/en/cluster-access/&#34;&gt;&lt;strong&gt;Cluster Accesss&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
        
      </description>
    </item>
    
    <item>
      <title>K3s Apuntes - Parte 1</title>
      <link>https://blog.fcch.xyz/post/infrastructure/k3s-notes-first/</link>
      <pubDate>Sat, 26 Jun 2021 00:00:00 +0000</pubDate>
      
      <guid>https://blog.fcch.xyz/post/infrastructure/k3s-notes-first/</guid>
      <description>
        
          &lt;p&gt;Experimentando con &lt;a href=&#34;https://docs.docker.com/engine/swarm/&#34;&gt;&lt;strong&gt;Docker Swarm&lt;/strong&gt;&lt;/a&gt; me puse a la tarea de armar algo con los &lt;a href=&#34;https://www.raspberrypi.org/&#34;&gt;&lt;strong&gt;Raspberry Pi (RPI v3, RPI v4)&lt;/strong&gt;&lt;/a&gt; que tengo en mi laboratorio, luego de estar googleando y charlando con &lt;a href=&#34;https://twitter.com/donkeysharp&#34;&gt;&lt;strong&gt;Sergio&lt;/strong&gt;&lt;/a&gt;, me recomendó usar &lt;a href=&#34;https://k3s.io/&#34;&gt;&lt;strong&gt;K3s&lt;/strong&gt;&lt;/a&gt; que es una distribución de &lt;a href=&#34;https://kubernetes.io/&#34;&gt;&lt;strong&gt;Kubernetes&lt;/strong&gt;&lt;/a&gt; con backend de almacenamiento ligero basado en &lt;a href=&#34;https://www.sqlite.org/index.html&#34;&gt;&lt;strong&gt;sqlite3&lt;/strong&gt;&lt;/a&gt; compatible con arquitectura &lt;a href=&#34;https://en.wikipedia.org/wiki/ARM_architecture&#34;&gt;&lt;strong&gt;ARM&lt;/strong&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://blog.fcch.xyz/images/k3s-kubernetes/k3s-kubernetes-part-1.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;Revisamos la documentación oficial de &lt;a href=&#34;https://rancher.com/docs/k3s/latest/en/&#34;&gt;&lt;strong&gt;K3s&lt;/strong&gt;&lt;/a&gt; y pude armar mi laboratorio, el tipo de ejercicio que se desarrollara sera un &lt;strong&gt;Server node&lt;/strong&gt; y cuatro &lt;strong&gt;Worker nodes&lt;/strong&gt; con la  base de datos &lt;a href=&#34;https://www.sqlite.org/index.html&#34;&gt;&lt;strong&gt;sqlite3&lt;/strong&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;h2 id=&#34;arquitectura&#34;&gt;Arquitectura&lt;/h2&gt;
&lt;p&gt;Existen dos tipos de nodos:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;Server node&lt;/strong&gt;, es el nodo que ejecuta &lt;strong&gt;K3s server&lt;/strong&gt;.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Worker node&lt;/strong&gt;, es el nodo que ejecuta &lt;strong&gt;K3s agent&lt;/strong&gt;.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;También existen dos formas de implementación:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;Un solo servidor con una base de datos integrada&lt;/strong&gt;, en esta configuración, cada nodo de agente está registrado en el mismo &lt;strong&gt;Server node&lt;/strong&gt;.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;img src=&#34;https://blog.fcch.xyz/images/k3s-kubernetes/k3s-architecture-single-server.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Servidor K3s de Alta Disponibilidad con una base de datos externa&lt;/strong&gt;, que se compone de:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Dos o más &lt;strong&gt;nodos de servidor&lt;/strong&gt; que servirán a la API de &lt;strong&gt;Kubernetes&lt;/strong&gt; y ejecutarán otros servicios del plano de control.&lt;/li&gt;
&lt;li&gt;Un &lt;strong&gt;almacén de datos externo&lt;/strong&gt; (a diferencia del almacén de datos SQLite incorporado que se usa en configuraciones de un solo servidor).&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;img src=&#34;https://blog.fcch.xyz/images/k3s-kubernetes/k3s-architecture-ha-server.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;2.1 &lt;strong&gt;Direcciones de registro fija para nodos agente&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;En la configuración del servidor de alta disponibilidad, cada nodo también debe registrarse con la API de &lt;strong&gt;Kubernetes&lt;/strong&gt; mediante una dirección de registro fija, después del registro, los nodos del agente establecen una conexión directamente con uno de los &lt;strong&gt;Server nodes&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://blog.fcch.xyz/images/k3s-kubernetes/k3s-production-setup.svg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;configuraciones-previas&#34;&gt;Configuraciones Previas&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://rancher.com/docs/k3s/latest/en/advanced/#enabling-legacy-iptables-on-raspbian-buster&#34;&gt;&lt;strong&gt;Configuraciones necesarias RPI&lt;/strong&gt;&lt;/a&gt;: Antes de instalar los binarios de &lt;a href=&#34;https://k3s.io/&#34;&gt;&lt;strong&gt;K3s&lt;/strong&gt;&lt;/a&gt; es necesario realizar unas configuraciones extra en el sistema operativo de las &lt;a href=&#34;https://www.raspberrypi.org/&#34;&gt;&lt;strong&gt;Raspberry Pi&lt;/strong&gt;&lt;/a&gt;, utilizaremos &lt;strong&gt;Raspbian Buster&lt;/strong&gt; para este laboratorio.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Habilitar iptables heredados en Raspbian Buster&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;Raspbian Buster&lt;/strong&gt; utiliza de forma predeterminada en &lt;strong&gt;nftables&lt;/strong&gt; en lugar de &lt;strong&gt;iptables&lt;/strong&gt;. Las funciones de red de &lt;strong&gt;K3s&lt;/strong&gt; requieren &lt;strong&gt;iptables&lt;/strong&gt; y no funcionan con &lt;strong&gt;nftables&lt;/strong&gt;, para solucionar este problema debemos realizar el cambio correspondiente.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;ln&#34;&gt;1&lt;/span&gt;$ sudo iptables -F
&lt;span class=&#34;ln&#34;&gt;2&lt;/span&gt;$ sudo update-alternatives --set iptables /usr/sbin/iptables-legacy
&lt;span class=&#34;ln&#34;&gt;3&lt;/span&gt;$ sudo update-alternatives --set ip6tables /usr/sbin/ip6tables-legacy
&lt;span class=&#34;ln&#34;&gt;4&lt;/span&gt;$ sudo reboot
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Habilitando cgroups para Raspbian Buster&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Las instalaciones estándar de &lt;strong&gt;Raspbian Buster&lt;/strong&gt; no se inicializan con &lt;strong&gt;cgroups&lt;/strong&gt; habilitado. &lt;strong&gt;K3s&lt;/strong&gt; necesita &lt;strong&gt;cgroups&lt;/strong&gt; inicializado como un servicio systemd. Se puede habilitar &lt;strong&gt;cgroups&lt;/strong&gt; agregando &lt;strong&gt;cgroup_memory=1&lt;/strong&gt; y &lt;strong&gt;cgroup_enable=memory&lt;/strong&gt; en &lt;strong&gt;/boot/cmdline.txt&lt;/strong&gt;.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-text&#34; data-lang=&#34;text&#34;&gt;&lt;span class=&#34;ln&#34;&gt;1&lt;/span&gt;# Dentro del archivo cmdline.txt
&lt;span class=&#34;ln&#34;&gt;2&lt;/span&gt;console=serial0,115200 console=tty1 root=PARTUUID=58b06195-02 rootfstype=ext4 elevator=deadline fsck.repair=yes rootwait cgroup_memory=1 cgroup_enable=memory
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Con estos cambios aplicados se debe reiniciar el sistema operativo en los &lt;strong&gt;Raspberry Pi&lt;/strong&gt;.&lt;/p&gt;
&lt;h2 id=&#34;instalación-del-server-node&#34;&gt;Instalación del Server node&lt;/h2&gt;
&lt;p&gt;Según la documentación oficial podemos utilizar los scripts oficiales para instalar los binarios para el &lt;strong&gt;Server node&lt;/strong&gt; de &lt;strong&gt;K3s&lt;/strong&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;ln&#34;&gt;1&lt;/span&gt;$ curl -sfL https://get.k3s.io &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; sh -
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Este script instalará todas la herramientas necesarias como:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;kubectl&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;crictl&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ctr&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;k3s-killall.sh&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;k3s-uninstall.sh&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;También creara el archivo de configuración &lt;strong&gt;/etc/rancher/k3s/k3s.yaml&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id=&#34;instalación-de-worker-nodes&#34;&gt;Instalación de Worker Nodes&lt;/h2&gt;
&lt;p&gt;Luego de la instalación del servidor &lt;strong&gt;K3s&lt;/strong&gt; podemos agregar nodos:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;ln&#34;&gt;1&lt;/span&gt;$ curl -sfL https://get.k3s.io &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;K3S_URL&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;https://myserver:6443 &lt;span class=&#34;nv&#34;&gt;K3S_TOKEN&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;mynodetoken sh -
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;donde:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;K3S_URL&lt;/strong&gt;: Esta es la dirección IP o el dominio del servidor &lt;strong&gt;K3s&lt;/strong&gt;.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;K3S_TOKEN&lt;/strong&gt;: Es un token que se almacena en el servidor &lt;strong&gt;K3s&lt;/strong&gt;, &lt;strong&gt;/var/lib/rancher/k3s/server/node-token&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;Es necesario que el hostname de los nuevos nodos sean diferentes.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;operaciones-básicas&#34;&gt;Operaciones Básicas&lt;/h2&gt;
&lt;p&gt;Podemos ejecutar los comandos comunes de &lt;strong&gt;Kubernetes&lt;/strong&gt; o utilizar el comando &lt;strong&gt;K3s&lt;/strong&gt;, a estos dos comandos debemos anteponerle el comando &lt;strong&gt;sudo&lt;/strong&gt; para que se ejecuten las ordenes sin problemas.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;ln&#34;&gt;1&lt;/span&gt;$ sudo k3s kubectl get nodes
&lt;span class=&#34;ln&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;# o también&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;3&lt;/span&gt;$ sudo kubectl get nodes
&lt;span class=&#34;ln&#34;&gt;4&lt;/span&gt;$ sudo kubectl get pods --all-namespaces
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Control daemon:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;ln&#34;&gt;1&lt;/span&gt;$ sudo systemctl status k3s
&lt;span class=&#34;ln&#34;&gt;2&lt;/span&gt;$ sudo systemctl stop k3s
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;referencias&#34;&gt;Referencias&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://rancher.com/docs/k3s/latest/en/quick-start/&#34;&gt;&lt;strong&gt;Inicio Rapido&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://rancher.com/docs/k3s/latest/en/installation/install-options/server-config/&#34;&gt;&lt;strong&gt;Configuración del Servidor&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://rancher.com/docs/k3s/latest/en/installation/install-options/&#34;&gt;&lt;strong&gt;Opciones de Instalación&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://rancher.com/docs/k3s/latest/en/installation/kube-dashboard/&#34;&gt;&lt;strong&gt;Kube Dashboard&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://rancher.com/docs/&#34;&gt;&lt;strong&gt;Docs K3S&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://k3s.io/&#34;&gt;&lt;strong&gt;Web Oficial&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://rancher.com/docs/k3s/latest/en/architecture/&#34;&gt;&lt;strong&gt;Arquitectura&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
        
      </description>
    </item>
    
    <item>
      <title>Doctl Cli - Digitalocean</title>
      <link>https://blog.fcch.xyz/post/infrastructure/doctl-digitalocean/</link>
      <pubDate>Wed, 30 Dec 2020 00:00:00 +0000</pubDate>
      
      <guid>https://blog.fcch.xyz/post/infrastructure/doctl-digitalocean/</guid>
      <description>
        
          &lt;p&gt;&lt;strong&gt;&lt;a href=&#34;https://digitalocean.com&#34;&gt;Digitalocean&lt;/a&gt;&lt;/strong&gt; también dispone de un CLI para manejar la infraestructura &amp;quot;&lt;strong&gt;&lt;a href=&#34;https://www.digitalocean.com/docs/apis-clis/doctl/reference/&#34;&gt;DOCTL&lt;/a&gt;&lt;/strong&gt;&amp;quot;, que tiene un funcionamiento similar a &lt;strong&gt;&lt;a href=&#34;https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-install.html&#34;&gt;AWS CLI&lt;/a&gt;&lt;/strong&gt;, esta herramienta nos permite evitar utilizar la interfaz web de este proveedor.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://blog.fcch.xyz/images/doctl-digitalocean/doctl.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;instalación-del-binario&#34;&gt;Instalación del Binario&lt;/h2&gt;
&lt;p&gt;Lo primero que toco hacer es descargar e instalar el binario, esto para la versión actual &lt;strong&gt;1.54.0&lt;/strong&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-cmd&#34; data-lang=&#34;cmd&#34;&gt;&lt;span class=&#34;ln&#34;&gt;1&lt;/span&gt;$ cd ~
&lt;span class=&#34;ln&#34;&gt;2&lt;/span&gt;$ wget https://github.com/digitalocean/doctl/releases/download/v1.54.0/doctl-1.54.0-linux-amd64.tar.gz
&lt;span class=&#34;ln&#34;&gt;3&lt;/span&gt;$ tar xf ~/doctl-1.54.0-linux-amd64.tar.gz
&lt;span class=&#34;ln&#34;&gt;4&lt;/span&gt;$ sudo mv ~/doctl /usr/local/bin
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;crear-un-token-api&#34;&gt;Crear un Token API&lt;/h2&gt;
&lt;p&gt;Antes de utilizar &amp;quot;&lt;strong&gt;&lt;a href=&#34;https://www.digitalocean.com/docs/apis-clis/doctl/reference/&#34;&gt;doctl&lt;/a&gt;&lt;/strong&gt;&amp;quot;, es necesario crear un Token API de &lt;strong&gt;&lt;a href=&#34;https://digitalocean.com&#34;&gt;digitalocean&lt;/a&gt;&lt;/strong&gt; para su cuenta, con acceso de lectura y escritura desde la página &lt;strong&gt;Aplicaciones&lt;/strong&gt; y &lt;strong&gt;API&lt;/strong&gt; en el panel de control.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://blog.fcch.xyz/images/doctl-digitalocean/token-api-name.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;La cadena del token solo se muestra una vez, entonces copie y guarde en un lugar seguro.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://blog.fcch.xyz/images/doctl-digitalocean/token-api-value.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;acceso-a-cuenta-con-token-api-y-doctl&#34;&gt;Acceso a cuenta con Token API y doctl&lt;/h2&gt;
&lt;p&gt;El Token API otorga acceso a &amp;quot;&lt;strong&gt;&lt;a href=&#34;https://www.digitalocean.com/docs/apis-clis/doctl/reference/&#34;&gt;doctl&lt;/a&gt;&lt;/strong&gt;&amp;quot; para su cuenta de &lt;strong&gt;&lt;a href=&#34;https://digitalocean.com&#34;&gt;digitalocean&lt;/a&gt;&lt;/strong&gt;. Pase la cadena del Token cuando se solicite, al ejecutar el comando de &amp;quot;&lt;strong&gt;&lt;a href=&#34;https://www.digitalocean.com/docs/apis-clis/doctl/reference/&#34;&gt;doctl&lt;/a&gt;&lt;/strong&gt;&amp;quot;.&lt;/p&gt;
&lt;p&gt;Puede utilizar varias cuentas, utilizando diferentes nombres, para esta función el parámetro &lt;strong&gt;--context&lt;/strong&gt; lo permite.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-cmd&#34; data-lang=&#34;cmd&#34;&gt;&lt;span class=&#34;ln&#34;&gt;1&lt;/span&gt;$ doctl auth init --context &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;NOMBRE_CUENTA1&amp;gt;
&lt;span class=&#34;ln&#34;&gt;2&lt;/span&gt;$ doctl auth init --context &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;NOMBRE_CUENTA2&amp;gt;
&lt;span class=&#34;ln&#34;&gt;3&lt;/span&gt;$ doctl auth init --context &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;NOMBRE_CUENTA3&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Se puede listar todas las cuentas con el siguiente comando:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-cmd&#34; data-lang=&#34;cmd&#34;&gt;&lt;span class=&#34;ln&#34;&gt;1&lt;/span&gt;$ doctl auth list
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Para cambiar entre las diferentes cuentas existentes:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-cmd&#34; data-lang=&#34;cmd&#34;&gt;&lt;span class=&#34;ln&#34;&gt;1&lt;/span&gt;$ doctl auth switch --context &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;NOMBRE_CUENTA_DISPONIBLE&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;ejemplos-de-uso&#34;&gt;Ejemplos de uso&lt;/h2&gt;
&lt;p&gt;Podemos utilizar &amp;quot;&lt;strong&gt;&lt;a href=&#34;https://www.digitalocean.com/docs/apis-clis/doctl/reference/&#34;&gt;doctl&lt;/a&gt;&lt;/strong&gt;&amp;quot; en diferentes casos.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Verificar Cuenta&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-cmd&#34; data-lang=&#34;cmd&#34;&gt;&lt;span class=&#34;ln&#34;&gt;1&lt;/span&gt;$ doctl account get
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Listar Droplets&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-cmd&#34; data-lang=&#34;cmd&#34;&gt;&lt;span class=&#34;ln&#34;&gt;1&lt;/span&gt;$ doctl compute droplet list
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Crear Droplet&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-cmd&#34; data-lang=&#34;cmd&#34;&gt;&lt;span class=&#34;ln&#34;&gt;1&lt;/span&gt;$ doctl compute droplet create --region sfo2 --image ubuntu-18-04-x64 --size s-1vcpu-1gb &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;NOMBRE_DROPLET&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Eliminar Droplet&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-cmd&#34; data-lang=&#34;cmd&#34;&gt;&lt;span class=&#34;ln&#34;&gt;1&lt;/span&gt;$ doctl compute droplet delete &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;ID_DROPLET&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;referencias&#34;&gt;Referencias&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.digitalocean.com/docs/apis-clis/&#34;&gt;&lt;strong&gt;APIS CLIS&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.digitalocean.com/docs/apis-clis/doctl/&#34;&gt;&lt;strong&gt;DOCTL CLI&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
        
      </description>
    </item>
    
    <item>
      <title>Limite de Memoria en Docker</title>
      <link>https://blog.fcch.xyz/post/infrastructure/limite-memoria-docker/</link>
      <pubDate>Wed, 12 Aug 2020 00:00:00 +0000</pubDate>
      
      <guid>https://blog.fcch.xyz/post/infrastructure/limite-memoria-docker/</guid>
      <description>
        
          &lt;p&gt;Cuando creamos un nuevo contenedor, el mismo tiene acceso ilimitado a los recursos del sistema, así que si uno ocupa toda la memoria los demás contenedores serán afectados o en su defecto el sistema operativo se queda sin recursos.&lt;/p&gt;
&lt;p&gt;Docker tiene la posibilidad de aplicar un límite de memoria a un contenedor específico.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://blog.fcch.xyz/images/docker-limite-mem/kernel-panic.jpg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;creando-un-contenedor&#34;&gt;Creando un Contenedor&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-cmd&#34; data-lang=&#34;cmd&#34;&gt;&lt;span class=&#34;ln&#34;&gt;1&lt;/span&gt;$ docker run --name dell -it debian bash
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;obteniendo-información-del-contenedor&#34;&gt;Obteniendo Información del Contenedor&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-cmd&#34; data-lang=&#34;cmd&#34;&gt;&lt;span class=&#34;ln&#34;&gt;1&lt;/span&gt;$ docker inspect dell &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; grep -i &amp;#39;Memory&amp;#39;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://blog.fcch.xyz/images/docker-limite-mem/docker-memory.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;Para &lt;strong&gt;&amp;quot;Memory&amp;quot;: 0&lt;/strong&gt; el valor &lt;strong&gt;0&lt;/strong&gt; indica que el contenedor no tiene valor limitado de memoria, es decir que utilizará todo lo que tenga disponible el host, posiblemente afectando a otros contenedores que estén dentro del mismo host.&lt;/p&gt;
&lt;h2 id=&#34;actualizando-la-memoria-del-contenedor&#34;&gt;Actualizando la Memoria del Contenedor&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-cmd&#34; data-lang=&#34;cmd&#34;&gt;&lt;span class=&#34;ln&#34;&gt;1&lt;/span&gt;$ docker update -m 256MB dell
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;En las pruebas existieron problemas en sistemas operativos Debian y Ubuntu:&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://blog.fcch.xyz/images/docker-limite-mem/docker-kernel-fail.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;Este problema se debe a que el &lt;a href=&#34;https://en.wikipedia.org/wiki/Cgroups&#34;&gt;&lt;strong&gt;cgroup&lt;/strong&gt;&lt;/a&gt; no esta montado en el sistema, para que se monte editamos el archivo archivo &lt;strong&gt;grub&lt;/strong&gt;.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-cmd&#34; data-lang=&#34;cmd&#34;&gt;&lt;span class=&#34;ln&#34;&gt;1&lt;/span&gt;$ sudo vim /etc/default/grub
&lt;span class=&#34;ln&#34;&gt;2&lt;/span&gt;    ...
&lt;span class=&#34;ln&#34;&gt;3&lt;/span&gt;    GRUB_CMDLINE_LINUX_DEFAULT=&lt;span class=&#34;s2&#34;&gt;&amp;#34;cgroup_enable=memory swapaccount=1&amp;#34;&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;4&lt;/span&gt;    GRUB_CMDLINE_LINUX=&lt;span class=&#34;s2&#34;&gt;&amp;#34;cgroup_enable=memory swapaccount=1&amp;#34;&lt;/span&gt;
&lt;span class=&#34;ln&#34;&gt;5&lt;/span&gt;    ...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Actualizamos el &lt;strong&gt;grub&lt;/strong&gt; y reiniciamos el sistema:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-cmd&#34; data-lang=&#34;cmd&#34;&gt;&lt;span class=&#34;ln&#34;&gt;1&lt;/span&gt;$ sudo update-grub
&lt;span class=&#34;ln&#34;&gt;2&lt;/span&gt;$ sudo update-grub2
&lt;span class=&#34;ln&#34;&gt;3&lt;/span&gt;$ sudo reboot
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Por último volvemos a ejecutar el comando para actualizar la memoria y verificamos el estado de la memoria:&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://blog.fcch.xyz/images/docker-limite-mem/docker-update-mem.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;referencias&#34;&gt;Referencias&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://fedoramagazine.org/docker-and-fedora-32/&#34;&gt;&lt;strong&gt;Fedora Magazine&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://fedoraproject.org/wiki/Changes/CGroupsV2&#34;&gt;&lt;strong&gt;Fedora Wiki&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
        
      </description>
    </item>
    
  </channel>
</rss>
